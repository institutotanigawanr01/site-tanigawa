<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seu Prop√≥sito Nasceu</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a2b4a 0%, #2d4a7c 100%);
            min-height: 100vh;
            color: #ffffff;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .container { max-width: 800px; width: 100%; text-align: center; }
        .nascimento {
            background: radial-gradient(circle, rgba(244, 208, 63, 0.2) 0%, rgba(0,0,0,0.6) 100%);
            border: 2px solid rgba(244, 208, 63, 0.5);
            border-radius: 30px;
            padding: 60px 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
        }
        .celebracao { font-size: 4em; margin-bottom: 20px; }
        h1 {
            font-size: 1.2em;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            color: #f4d03f;
            margin-bottom: 30px;
        }
        .proposito {
            font-size: 2.5em;
            font-weight: 800;
            color: #ffffff;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.4);
            line-height: 1.3;
            margin: 30px 0;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
        }
        .btn {
            margin: 15px 10px;
            background: linear-gradient(135deg, #d4af37 0%, #f4d03f 100%);
            color: #1a2b4a;
            border: none;
            padding: 15px 35px;
            font-size: 1em;
            font-weight: 600;
            border-radius: 999px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }
        @media (max-width: 768px) {
            .proposito { font-size: 1.8em; }
            .nascimento { padding: 40px 25px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="nascimento">
            <div class="celebracao">üéâ</div>
            <h1>SEU PROP√ìSITO NASCEU!</h1>
            <div class="proposito" id="proposito-principal">ANALISANDO...</div>
            <a href="relatorio-final.html" class="btn">üìã Ver Relat√≥rio Completo</a>
            <a href="utero-base.html" class="btn">üîÑ Refazer</a>
        </div>
    </div>
    <script>
        // ‚úÖ VALIDA√á√ÉO: M√≠nimo de caracteres e campos obrigat√≥rios
        const MIN_CARACTERES = 50;
        const CAMPOS_OBRIGATORIOS = [
            'concepcao1', 'concepcao2', 'concepcao3',
            'implantacao1', 'implantacao2', 'implantacao3',
            'batimento1', 'batimento2', 'batimento3',
            'membros1', 'membros2', 'membros3',
            'chute1', 'chute2', 'chute3',
            'olhos1', 'olhos2', 'olhos3',
            'respiracao1', 'respiracao2', 'respiracao3',
            'voz1', 'voz2', 'voz3',
            'parto1', 'parto2', 'parto3'
        ];

        // ‚úÖ VALIDA√á√ÉO: Verifica se h√° dados suficientes
        function validarDadosSuficientes() {
            let camposValidos = 0;
            let totalCaracteres = 0;

            CAMPOS_OBRIGATORIOS.forEach(campo => {
                const valor = (localStorage.getItem(campo) || '').trim();
                totalCaracteres += valor.length;
                
                if (valor.length >= MIN_CARACTERES) {
                    camposValidos++;
                }
            });

            // ‚úÖ CRIT√âRIO: Pelo menos 80% dos campos preenchidos E total m√≠nimo de caracteres
            const percentualValido = (camposValidos / CAMPOS_OBRIGATORIOS.length) * 100;
            const caracteresMinimos = MIN_CARACTERES * CAMPOS_OBRIGATORIOS.length * 0.8; // 80% do total esperado

            return {
                valido: percentualValido >= 80 && totalCaracteres >= caracteresMinimos,
                percentual: percentualValido.toFixed(0),
                camposValidos: camposValidos,
                totalCampos: CAMPOS_OBRIGATORIOS.length,
                totalCaracteres: totalCaracteres
            };
        }

        function analisar() {
            const r = {}, c = CAMPOS_OBRIGATORIOS;
            c.forEach(k => r[k] = (localStorage.getItem(k) || '').trim());
            const t = Object.values(r).join(' ').toLowerCase();
            
            // ‚úÖ PROTE√á√ÉO: Se n√£o h√° texto suficiente, retorna null
            if (t.length < 500) {
                return null;
            }
            
            const p = {
                verbos: {
                    'LIBERTAR':['libert','free','livr'],
                    'CURAR':['curar','cura','restaur','sarar'],
                    'FORMAR':['ensinar','educar','formar','treinar'],
                    'CONSTRUIR':['construir','edificar','criar','fundar'],
                    'DESPERTAR':['despertar','revel','acordar'],
                    'GUIAR':['guiar','liderar','conduzir','orientar'],
                    'TRANSFORMAR':['transform','mudar','converter']
                },
                dest: {
                    'JOVENS':['jovem','adolescent','juventude'],
                    'MULHERES':['mulher','feminino'],
                    'HOMENS':['homem','masculino','pai'],
                    'L√çDERES':['l√≠der','lider','pastor','gestor'],
                    'CRIAN√áAS':['crian√ßa','infantil','pequeno'],
                    'EMPRES√ÅRIOS':['empres√°r','empreend','neg√≥cio'],
                    'FAM√çLIAS':['fam√≠lia','casal','lar']
                },
                cond: {
                    'FERIDOS':['ferido','dor','trauma','machucado'],
                    'APRISIONADOS':['preso','cativo','escrav'],
                    'PERDIDOS':['perdido','confuso','sem rumo'],
                    '√ìRF√ÉOS':['√≥rf√£o','abandon','desampar'],
                    'OPRIMIDOS':['oprimido','injusti√ßa','sofr']
                }
            };
            
            function calc(cat) {
                const res = {};
                for(const [n,pl] of Object.entries(p[cat])) {
                    let peso = 0;
                    pl.forEach(pal => {
                        const m = t.match(new RegExp(pal,'gi'));
                        if(m) peso += m.length;
                    });
                    res[n] = peso;
                }
                return res;
            }
            
            function dom(pesos) {
                let max=0, d=null;
                for(const [n,pe] of Object.entries(pesos)) {
                    if(pe>max) { max=pe; d=n; }
                }
                return d;
            }
            
            const v = dom(calc('verbos'));
            const d = dom(calc('dest'));
            const co = dom(calc('cond'));
            
            // ‚úÖ PROTE√á√ÉO: Se n√£o encontrou nenhum padr√£o dominante, retorna null
            if (!v && !d && !co) {
                return null;
            }
            
            // ‚úÖ USA FALLBACK APENAS QUANDO PELO MENOS 1 PADR√ÉO FOI DETECTADO
            return `${v || 'TRANSFORMAR'} ${d || 'PESSOAS'} ${co || 'PERDIDAS'}`;
        }

        window.onload = () => {
            // ‚úÖ VALIDA√á√ÉO CR√çTICA: Verifica dados antes de processar
            const validacao = validarDadosSuficientes();
            
            if (!validacao.valido) {
                // ‚úÖ REDIRECIONA PARA TELA DE ERRO
                localStorage.setItem('erro_validacao', JSON.stringify({
                    percentual: validacao.percentual,
                    camposValidos: validacao.camposValidos,
                    totalCampos: validacao.totalCampos,
                    origem: 'resultado-proposito'
                }));
                window.location.href = 'erro-diagnostico.html';
                return;
            }

            // ‚úÖ Tenta analisar
            const prop = analisar();
            
            if (!prop) {
                // ‚úÖ Se an√°lise falhou mesmo com valida√ß√£o, redireciona
                localStorage.setItem('erro_validacao', JSON.stringify({
                    tipo: 'analise_falhou',
                    origem: 'resultado-proposito'
                }));
                window.location.href = 'erro-diagnostico.html';
                return;
            }
            
            // ‚úÖ Sucesso: Exibe o resultado
            document.getElementById('proposito-principal').textContent = prop;
            localStorage.setItem('tema_central', prop);
        };
    </script>
</body>
</html>
