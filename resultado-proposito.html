<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seu PropÃ³sito Nasceu</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a2b4a 0%, #2d4a7c 100%);
            min-height: 100vh;
            color: #ffffff;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .container { max-width: 800px; width: 100%; text-align: center; }
        .nascimento {
            background: radial-gradient(circle, rgba(244, 208, 63, 0.2) 0%, rgba(0,0,0,0.6) 100%);
            border: 2px solid rgba(244, 208, 63, 0.5);
            border-radius: 30px;
            padding: 60px 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
        }
        .celebracao { font-size: 4em; margin-bottom: 20px; }
        h1 {
            font-size: 1.2em;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            color: #f4d03f;
            margin-bottom: 30px;
        }
        .proposito {
            font-size: 2.5em;
            font-weight: 800;
            color: #ffffff;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.4);
            line-height: 1.3;
            margin: 30px 0;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
        }
        .btn {
            margin: 15px 10px;
            background: linear-gradient(135deg, #d4af37 0%, #f4d03f 100%);
            color: #1a2b4a;
            border: none;
            padding: 15px 35px;
            font-size: 1em;
            font-weight: 600;
            border-radius: 999px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }
        @media (max-width: 768px) {
            .proposito { font-size: 1.8em; }
            .nascimento { padding: 40px 25px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="nascimento">
            <div class="celebracao">ðŸŽ‰</div>
            <h1>SEU PROPÃ“SITO NASCEU!</h1>
            <div class="proposito" id="proposito-principal">ANALISANDO...</div>
            <a href="relatorio-executivo.html" class="btn">ðŸ“„ Ver RelatÃ³rio Executivo</a>
            <a href="relatorio-completo.html" class="btn">ðŸ“‹ Ver RelatÃ³rio Completo</a>
            <a href="utero-base.html" class="btn">ðŸ”„ Refazer</a>
        </div>
    </div>
    <script>
        // âœ… VALIDAÃ‡ÃƒO INTELIGENTE: MÃ­nimos especÃ­ficos por campo
        const MIN_CARACTERES_POR_CAMPO = {
            'concepcao1': 40, 'concepcao2': 2, 'concepcao3': 10,
            'implantacao1': 50, 'implantacao2': 50, 'implantacao3': 40,
            'batimento1': 10, 'batimento2': 20, 'batimento3': 20,
            'membros1': 40, 'membros2': 25, 'membros3': 40,
            'chute1': 40, 'chute2': 20, 'chute3': 10,
            'olhos1': 40, 'olhos2': 30, 'olhos3': 40,
            'respiracao1': 30, 'respiracao2': 10, 'respiracao3': 10,
            'voz1': 20, 'voz2': 10, 'voz3': 40,
            'parto1': 40, 'parto2': 40, 'parto3': 30
        };
        
        const CAMPOS_OBRIGATORIOS = [
            'concepcao1', 'concepcao2', 'concepcao3',
            'implantacao1', 'implantacao2', 'implantacao3',
            'batimento1', 'batimento2', 'batimento3',
            'membros1', 'membros2', 'membros3',
            'chute1', 'chute2', 'chute3',
            'olhos1', 'olhos2', 'olhos3',
            'respiracao1', 'respiracao2', 'respiracao3',
            'voz1', 'voz2', 'voz3',
            'parto1', 'parto2', 'parto3'
        ];

        function validarDadosSuficientes() {
            let camposValidos = 0;
            let totalCaracteres = 0;
            let totalCaracteresEsperados = 0;

            CAMPOS_OBRIGATORIOS.forEach(campo => {
                const valor = (localStorage.getItem(campo) || '').trim();
                const minimoEspecifico = MIN_CARACTERES_POR_CAMPO[campo] || 50;
                
                totalCaracteres += valor.length;
                totalCaracteresEsperados += minimoEspecifico;
                
                if (valor.length >= minimoEspecifico) {
                    camposValidos++;
                }
            });

            const percentualValido = (camposValidos / CAMPOS_OBRIGATORIOS.length) * 100;
            const caracteresMinimos = totalCaracteresEsperados * 0.8;

            return {
                valido: percentualValido >= 80 && totalCaracteres >= caracteresMinimos,
                percentual: percentualValido.toFixed(0),
                camposValidos: camposValidos,
                totalCampos: CAMPOS_OBRIGATORIOS.length,
                totalCaracteres: totalCaracteres
            };
        }

        // ðŸ§  MOTOR DE SÃNTESE INTELIGENTE
        class MotorSintese {
            constructor(respostas) {
                this.respostas = respostas;
                this.textoCompleto = Object.values(respostas).join(' ').toLowerCase();
                this.analise = {
                    verbos: [],
                    destinatarios: [],
                    condicoes: [],
                    meios: []
                };
            }

            analisarPadroes() {
                const padroes = {
                    verbos: {
                        'libertar': /libert|free|livr|soltar/gi,
                        'curar': /curar|cura|restaur|sarar|recuper/gi,
                        'revelar': /revel|mostrar|manifest|descob/gi,
                        'formar': /formar|ensinar|educar|treinar|capacit/gi,
                        'equipar': /equipar|prepar|habilit/gi,
                        'construir': /construir|edificar|criar|fundar/gi,
                        'despertar': /despertar|acord|ativar/gi,
                        'guiar': /guiar|liderar|conduzir|orientar|direcion/gi,
                        'transformar': /transform|mudar|converter/gi,
                        'restaurar': /restaur|renov|reconst/gi
                    },
                    destinatarios: {
                        'jovens': /jovem|juventude|adolescent/gi,
                        'mulheres': /mulher|feminino|damas/gi,
                        'homens': /homem|masculino|pais/gi,
                        'lÃ­deres': /lÃ­der|lider|pastor|gestor|diretor/gi,
                        'crianÃ§as': /crianÃ§a|infantil|pequeno/gi,
                        'empresÃ¡rios': /empresÃ¡r|empreend|negÃ³cio|executiv/gi,
                        'famÃ­lias': /famÃ­lia|casal|lar|matrimon/gi,
                        'pessoas': /pessoa|gente|indivÃ­duo/gi
                    },
                    condicoes: {
                        'feridos': /ferido|machucado|dor|trauma|sofr/gi,
                        'aprisionados': /preso|cativo|escrav/gi,
                        'perdidos': /perdido|confuso|sem rumo/gi,
                        'inseguros': /insegur|medo|receio|temor|dÃºvida/gi,
                        'quebrados': /quebr|destr|arrasad/gi,
                        'vazios': /vazio|oco|sem propÃ³sit/gi
                    },
                    meios: {
                        'mentoria': /mentor|acompanh|discipulad/gi,
                        'ensino': /ensin|aula|palestr|treinament/gi,
                        'escuta': /escuta|ouvir|ouvinte/gi,
                        'palavra': /palavra|mensagem|pregaÃ§/gi,
                        'exemplo': /exemplo|model|referÃªnci/gi
                    }
                };

                for (const [categoria, items] of Object.entries(padroes)) {
                    const scores = {};
                    for (const [palavra, regex] of Object.entries(items)) {
                        const matches = this.textoCompleto.match(regex);
                        if (matches) {
                            scores[palavra] = matches.length;
                        }
                    }
                    const sorted = Object.entries(scores)
                        .sort((a, b) => b[1] - a[1])
                        .map(([palavra]) => palavra);
                    
                    this.analise[categoria] = sorted;
                }

                return this.analise;
            }

            selecionarTemplate() {
                const templates = [
                    {
                        id: 'revelar_identidade',
                        patterns: ['revelar', 'mostrar', 'manifestar'],
                        structure: (v, d, c) => `Revelar aos ${d} ${c} seu verdadeiro valor e identidade`,
                    },
                    {
                        id: 'libertar_de_para',
                        patterns: ['libertar', 'livrar', 'soltar'],
                        structure: (v, d, c) => `Libertar ${d} ${c} para uma vida de propÃ³sito`,
                    },
                    {
                        id: 'equipar_governo',
                        patterns: ['equipar', 'preparar', 'formar'],
                        structure: (v, d, c) => `Equipar ${d} a viverem seu chamado com excelÃªncia`,
                    },
                    {
                        id: 'despertar_chamado',
                        patterns: ['despertar', 'acordar', 'ativar'],
                        structure: (v, d, c) => `Despertar em ${d} o chamado que transforma geraÃ§Ãµes`,
                    },
                    {
                        id: 'transformar_atraves',
                        patterns: ['transformar', 'mudar', 'converter'],
                        structure: (v, d, c) => `Transformar ${d} ${c} em agentes de mudanÃ§a`,
                    },
                    {
                        id: 'guiar_territorio',
                        patterns: ['guiar', 'liderar', 'conduzir'],
                        structure: (v, d, c) => `Guiar ${d} a descobrirem seu territÃ³rio de impacto`,
                    },
                    {
                        id: 'restaurar_completo',
                        patterns: ['restaurar', 'curar', 'sarar'],
                        structure: (v, d, c) => `Restaurar ${d} ${c} Ã  sua identidade original`,
                    }
                ];

                const verbo = this.analise.verbos[0];
                
                for (const template of templates) {
                    if (template.patterns.includes(verbo)) {
                        return template;
                    }
                }

                return {
                    id: 'generico',
                    structure: (v, d, c) => {
                        const parts = [];
                        if (v) parts.push(this.capitalize(v));
                        if (d) parts.push(d);
                        if (c) parts.push(c);
                        return parts.join(' ') + ' para transformaÃ§Ã£o genuÃ­na';
                    }
                };
            }

            gerarFraseInteligente() {
                this.analisarPadroes();

                if (this.textoCompleto.length < 500) {
                    return null;
                }

                const temPadroes = Object.values(this.analise).some(arr => arr.length > 0);
                if (!temPadroes) {
                    return null;
                }

                const template = this.selecionarTemplate();
                const verbo = this.analise.verbos[0];
                const dest = this.analise.destinatarios[0] || 'pessoas';
                const cond = this.formatarCondicao(this.analise.condicoes[0]);

                let frase = template.structure(verbo, dest, cond);
                frase = this.limparFrase(frase);
                frase = this.capitalize(frase);

                return {
                    frase: frase,
                    componentes: { verbo, dest, cond },
                    template: template.id
                };
            }

            formatarCondicao(condicao) {
                if (!condicao) return '';
                const mapa = {
                    'feridos': 'feridos pela vida',
                    'aprisionados': 'presos ao medo',
                    'perdidos': 'sem direÃ§Ã£o clara',
                    'inseguros': 'que duvidam de si',
                    'quebrados': 'emocionalmente quebrados',
                    'vazios': 'que buscam propÃ³sito'
                };
                return mapa[condicao] || condicao;
            }

            limparFrase(frase) {
                frase = frase.replace(/\s+/g, ' ');
                frase = frase.replace(/\s+(da|de|do)\s+undefined/gi, '');
                frase = frase.replace(/undefined/gi, '');
                return frase.trim();
            }

            capitalize(str) {
                if (!str) return '';
                return str.charAt(0).toUpperCase() + str.slice(1);
            }
        }

        window.onload = () => {
            const validacao = validarDadosSuficientes();
            
            if (!validacao.valido) {
                localStorage.setItem('erro_validacao', JSON.stringify({
                    percentual: validacao.percentual,
                    camposValidos: validacao.camposValidos,
                    totalCampos: validacao.totalCampos,
                    origem: 'resultado-proposito'
                }));
                window.location.href = 'erro-diagnostico.html';
                return;
            }

            const respostas = {};
            CAMPOS_OBRIGATORIOS.forEach(campo => {
                respostas[campo] = localStorage.getItem(campo) || '';
            });

            const motor = new MotorSintese(respostas);
            const resultado = motor.gerarFraseInteligente();
            
            if (!resultado) {
                localStorage.setItem('erro_validacao', JSON.stringify({
                    tipo: 'analise_falhou',
                    origem: 'resultado-proposito'
                }));
                window.location.href = 'erro-diagnostico.html';
                return;
            }

            document.getElementById('proposito-principal').textContent = resultado.frase;
            localStorage.setItem('proposito_inteligente', JSON.stringify(resultado));
            localStorage.setItem('tema_central', resultado.frase);
        };
    </script>
</body>
</html>
