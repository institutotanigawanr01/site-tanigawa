<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gest√£o de Produtos ‚Ä¢ Instituto Tanigawa</title>

  <!-- Fontes padr√£o do ecossistema -->
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet" />

  <style>
    :root {
      --primary-blue: #3b82f6;
      --primary-gold: #f59e0b;
      --dark-bg: #020617;
      --panel-bg: rgba(15,23,42,0.95);
      --card-bg: rgba(15,23,42,0.9);
      --card-soft: rgba(15,23,42,0.7);
      --text-light: #e2e8f0;
      --text-gray: #94a3b8;
      --success: #22c55e;
      --danger: #ef4444;
      --warning: #eab308;
      --radius-card: 20px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      min-height: 100vh;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at 10% 0%, rgba(59,130,246,0.35), transparent 55%),
        radial-gradient(circle at 90% 100%, rgba(236,72,153,0.3), transparent 55%),
        radial-gradient(circle at 0% 100%, rgba(34,197,94,0.25), transparent 60%),
        #020617;
      color: var(--text-light);
    }

    .page {
      max-width: 1200px;
      margin: 24px auto 40px;
      padding: 0 16px;
    }

    /* HEADER */
    .header {
      background: linear-gradient(135deg, rgba(15,23,42,0.98), rgba(15,23,42,0.9));
      border-radius: 24px;
      padding: 16px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border: 1px solid rgba(148,163,184,0.25);
      box-shadow: 0 18px 50px rgba(15,23,42,0.9);
      position: sticky;
      top: 16px;
      z-index: 10;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .logo-icon {
      width: 44px;
      height: 44px;
      border-radius: 18px;
      background: radial-gradient(circle at 0 0, #f97316, #ec4899 40%, #3b82f6 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: "Sora", system-ui, sans-serif;
      font-weight: 800;
      font-size: 1.2rem;
      color: #fff;
      box-shadow: 0 12px 28px rgba(15,23,42,0.8);
    }

    .logo-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .logo-sub {
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-gray);
    }

    .logo-title {
      font-family: "Sora", system-ui, sans-serif;
      font-size: 1.25rem;
      font-weight: 600;
    }

    .logo-title span {
      background: linear-gradient(120deg, #60a5fa, #a855f7);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-back {
      border: 1px solid rgba(248,113,113,0.4);
      background: rgba(127,29,29,0.35);
      color: #fecaca;
      border-radius: 999px;
      padding: 8px 14px;
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-back:hover {
      filter: brightness(1.03);
    }

    .badge-env {
      font-size: 0.72rem;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(148,163,184,0.4);
      color: var(--text-gray);
    }

    /* STATS */
    .stats-grid {
      margin-top: 24px;
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 16px;
    }

    .stat-card {
      background: var(--card-bg);
      border-radius: var(--radius-card);
      padding: 14px 16px;
      border: 1px solid rgba(148,163,184,0.28);
      box-shadow: 0 12px 30px rgba(15,23,42,0.7);
    }

    .stat-label {
      font-size: 0.8rem;
      color: var(--text-gray);
      margin-bottom: 4px;
    }

    .stat-value {
      font-family: "Sora", system-ui, sans-serif;
      font-size: 1.35rem;
      font-weight: 600;
    }

    .stat-footer {
      margin-top: 4px;
      font-size: 0.75rem;
      color: var(--text-gray);
    }

    /* TABS */
    .tabs {
      margin-top: 26px;
      display: flex;
      gap: 10px;
      background: rgba(15,23,42,0.9);
      padding: 6px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.35);
      width: fit-content;
    }

    .tab {
      border-radius: 999px;
      padding: 7px 16px;
      font-size: 0.82rem;
      border: none;
      background: transparent;
      color: var(--text-gray);
      cursor: pointer;
      font-weight: 500;
    }

    .tab.active {
      background: linear-gradient(120deg, #3b82f6, #8b5cf6);
      color: #f9fafb;
      box-shadow: 0 10px 24px rgba(59,130,246,0.55);
    }

    /* TOOLBAR & TABLE */
    .panel {
      margin-top: 18px;
      background: var(--card-soft);
      border-radius: var(--radius-card);
      padding: 16px 16px 18px;
      border: 1px solid rgba(148,163,184,0.3);
      box-shadow: 0 16px 40px rgba(15,23,42,0.9);
    }

    .toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 14px;
    }

    .search-box {
      flex: 1;
    }

    .search-box input {
      width: 100%;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.4);
      background: rgba(15,23,42,0.9);
      color: var(--text-light);
      font-size: 0.85rem;
    }

    .search-box input::placeholder {
      color: #64748b;
    }

    .btn-primary {
      border-radius: 999px;
      border: none;
      padding: 9px 16px;
      font-size: 0.82rem;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(120deg, #22c55e, #16a34a);
      color: #ecfdf5;
      box-shadow: 0 12px 28px rgba(22,163,74,0.6);
      white-space: nowrap;
    }

    .btn-primary:hover {
      filter: brightness(1.05);
    }

    .table-container {
      overflow-x: auto;
      border-radius: 16px;
      border: 1px solid rgba(51,65,85,0.8);
      background: radial-gradient(circle at 0 0, rgba(148,163,184,0.18), rgba(15,23,42,0.98));
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 640px;
    }

    thead {
      background: rgba(15,23,42,0.96);
    }

    th, td {
      padding: 10px 12px;
      font-size: 0.8rem;
      text-align: left;
      border-bottom: 1px solid rgba(30,41,59,0.9);
    }

    th {
      font-weight: 600;
      color: #cbd5f5;
    }

    tbody tr:hover {
      background: rgba(15,23,42,0.9);
    }

    .actions {
      display: flex;
      gap: 6px;
    }

    .btn-icon {
      border-radius: 999px;
      border: none;
      width: 28px;
      height: 28px;
      font-size: 0.8rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      background: rgba(15,23,42,0.85);
      color: #e5e7eb;
    }

    .btn-icon.danger {
      background: rgba(127,29,29,0.8);
      color: #fecaca;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.7rem;
      font-weight: 600;
    }

    .badge-success {
      background: rgba(22,163,74,0.15);
      color: #4ade80;
    }

    .badge-danger {
      background: rgba(220,38,38,0.15);
      color: #fca5a5;
    }

    .badge-warning {
      background: rgba(234,179,8,0.15);
      color: #facc15;
    }

    .empty-state {
      text-align: center;
      padding: 24px 12px;
      color: var(--text-gray);
      font-size: 0.86rem;
    }

    .empty-state-icon {
      font-size: 2.3rem;
      margin-bottom: 8px;
      opacity: 0.4;
    }

    /* MODAL */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 40;
    }

    .modal-backdrop.active {
      display: flex;
    }

    .modal {
      background: radial-gradient(circle at 0 0, rgba(148,163,184,0.25), rgba(15,23,42,0.98));
      border-radius: 20px;
      max-width: 520px;
      width: 100%;
      padding: 18px 18px 20px;
      border: 1px solid rgba(148,163,184,0.45);
      box-shadow: 0 24px 65px rgba(15,23,42,0.95);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .modal-title {
      font-family: "Sora", system-ui, sans-serif;
      font-size: 1rem;
      font-weight: 600;
    }

    .btn-close {
      border: none;
      background: transparent;
      color: var(--text-gray);
      font-size: 1.4rem;
      cursor: pointer;
      padding: 4px;
    }

    .btn-close:hover {
      color: #f9fafb;
    }

    .form-group {
      margin-bottom: 12px;
    }

    label {
      display: block;
      font-size: 0.78rem;
      color: var(--text-gray);
      margin-bottom: 4px;
      font-weight: 500;
    }

    input, select, textarea {
      width: 100%;
      border-radius: 10px;
      border: 1px solid rgba(148,163,184,0.5);
      background: rgba(15,23,42,0.9);
      color: var(--text-light);
      padding: 8px 10px;
      font-size: 0.82rem;
      font-family: "Inter", system-ui, sans-serif;
    }

    input::placeholder, textarea::placeholder {
      color: #64748b;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 1px rgba(59,130,246,0.7);
    }

    textarea {
      min-height: 80px;
      resize: vertical;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .modal-footer {
      margin-top: 8px;
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }

    .btn-secondary {
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(148,163,184,0.6);
      color: var(--text-light);
      padding: 8px 14px;
      font-size: 0.8rem;
      cursor: pointer;
    }

    .btn-secondary:hover {
      filter: brightness(1.05);
    }

    .btn-save {
      border-radius: 999px;
      background: linear-gradient(120deg, #3b82f6, #8b5cf6);
      border: none;
      color: #f9fafb;
      padding: 8px 16px;
      font-size: 0.82rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 10px 25px rgba(59,130,246,0.6);
    }

    .btn-save:hover {
      filter: brightness(1.05);
    }

    @media (max-width: 900px) {
      .stats-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width: 720px) {
      .header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }

      .toolbar {
        flex-direction: column;
        align-items: stretch;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      table {
        min-width: 100%;
      }

      .form-row {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <header class="header">
      <div class="logo">
        <div class="logo-icon">IT</div>
        <div class="logo-text">
          <div class="logo-sub">Painel de governo</div>
          <div class="logo-title"><span>Gest√£o de Produtos</span></div>
        </div>
      </div>
      <div class="header-actions">
        <span class="badge-env">Admin conectado</span>
        <button class="btn-back" onclick="window.location.href='admin_dashboard.html'">‚Üê Voltar ao painel</button>
      </div>
    </header>

    <!-- STATS -->
    <section class="stats-grid">
      <article class="stat-card">
        <div class="stat-label">Cursos & Mentor√≠as</div>
        <div id="statCursos" class="stat-value">0</div>
        <div class="stat-footer">Cadastrados no sistema</div>
      </article>
      <article class="stat-card">
        <div class="stat-label">Ebooks</div>
        <div id="statEbooks" class="stat-value">0</div>
        <div class="stat-footer">Dispon√≠veis para download</div>
      </article>
      <article class="stat-card">
        <div class="stat-label">Livros</div>
        <div id="statLivros" class="stat-value">0</div>
        <div class="stat-footer">Itens cadastrados</div>
      </article>
    </section>

    <!-- TABS -->
    <div class="tabs">
      <button class="tab active" id="tabBtn-cursos" onclick="switchTab('cursos', this)">Cursos</button>
      <button class="tab" id="tabBtn-ebooks" onclick="switchTab('ebooks', this)">Ebooks</button>
      <button class="tab" id="tabBtn-livros" onclick="switchTab('livros', this)">Livros</button>
    </div>

    <!-- PAINEL CURSOS -->
    <section id="tab-cursos" class="panel">
      <div class="toolbar">
        <div class="search-box">
          <input type="text" placeholder="Buscar cursos..." onkeyup="filtrar('cursos', this.value)" />
        </div>
        <button class="btn-primary" onclick="abrirModal('cursos')">+ Adicionar Curso</button>
      </div>

      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Nome</th>
              <th>Tipo</th>
              <th>Dura√ß√£o</th>
              <th>Pre√ßo</th>
              <th>Status</th>
              <th style="width: 90px;">A√ß√µes</th>
            </tr>
          </thead>
          <tbody id="tableCursos"></tbody>
        </table>
      </div>
    </section>

    <!-- PAINEL EBOOKS -->
    <section id="tab-ebooks" class="panel" style="display:none;">
      <div class="toolbar">
        <div class="search-box">
          <input type="text" placeholder="Buscar ebooks..." onkeyup="filtrar('ebooks', this.value)" />
        </div>
        <button class="btn-primary" onclick="abrirModal('ebooks')">+ Adicionar Ebook</button>
      </div>

      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>T√≠tulo</th>
              <th>Autor</th>
              <th>Pre√ßo</th>
              <th>Downloads</th>
              <th>Status</th>
              <th style="width: 90px;">A√ß√µes</th>
            </tr>
          </thead>
          <tbody id="tableEbooks"></tbody>
        </table>
      </div>
    </section>

    <!-- PAINEL LIVROS -->
    <section id="tab-livros" class="panel" style="display:none;">
      <div class="toolbar">
        <div class="search-box">
          <input type="text" placeholder="Buscar livros..." onkeyup="filtrar('livros', this.value)" />
        </div>
        <button class="btn-primary" onclick="abrirModal('livros')">+ Adicionar Livro</button>
      </div>

      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>T√≠tulo</th>
              <th>Autor</th>
              <th>ISBN</th>
              <th>Pre√ßo</th>
              <th>Estoque</th>
              <th style="width: 90px;">A√ß√µes</th>
            </tr>
          </thead>
          <tbody id="tableLivros"></tbody>
        </table>
      </div>
    </section>
  </div>

  <!-- MODAL CURSOS -->
  <div id="modalCursos" class="modal-backdrop">
    <div class="modal">
      <div class="modal-header">
        <h2 id="modalTitleCursos" class="modal-title">Adicionar Curso</h2>
        <button class="btn-close" onclick="fecharModal('cursos')">√ó</button>
      </div>
      <form id="formCursos" onsubmit="salvarProduto(event, 'cursos')">
        <input type="hidden" id="editIdCursos" />
        <div class="form-group">
          <label>Nome do Curso *</label>
          <input type="text" id="nomeCurso" required />
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Tipo</label>
            <input type="text" id="tipoCurso" placeholder="Mentoria, Curso, Imers√£o..." />
          </div>
          <div class="form-group">
            <label>Dura√ß√£o</label>
            <input type="text" id="duracaoCurso" placeholder="Ex: 6 encontros, 12 semanas..." />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Pre√ßo (R$) *</label>
            <input type="number" id="precoCurso" step="0.01" min="0" required />
          </div>
          <div class="form-group">
            <label>Status *</label>
            <select id="statusCurso" required>
              <option value="ativo">Ativo</option>
              <option value="inativo">Inativo</option>
              <option value="em breve">Em breve</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label>Descri√ß√£o</label>
          <textarea id="descricaoCurso" placeholder="Resumo do curso, p√∫blico alvo, benef√≠cios..."></textarea>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn-secondary" onclick="fecharModal('cursos')">Cancelar</button>
          <button type="submit" class="btn-save">Salvar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- MODAL EBOOKS -->
  <div id="modalEbooks" class="modal-backdrop">
    <div class="modal">
      <div class="modal-header">
        <h2 id="modalTitleEbooks" class="modal-title">Adicionar Ebook</h2>
        <button class="btn-close" onclick="fecharModal('ebooks')">√ó</button>
      </div>
      <form id="formEbooks" onsubmit="salvarProduto(event, 'ebooks')">
        <input type="hidden" id="editIdEbooks" />
        <div class="form-group">
          <label>T√≠tulo *</label>
          <input type="text" id="tituloEbook" required />
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Autor *</label>
            <input type="text" id="autorEbook" required />
          </div>
          <div class="form-group">
            <label>Pre√ßo (R$) *</label>
            <input type="number" id="precoEbook" step="0.01" min="0" required />
          </div>
        </div>
        <div class="form-group">
          <label>Link de Download</label>
          <input type="url" id="linkEbook" placeholder="https://..." />
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>URL da Capa</label>
            <input type="url" id="capaEbook" placeholder="https://..." />
          </div>
          <div class="form-group">
            <label>Status *</label>
            <select id="statusEbook" required>
              <option value="ativo">Ativo</option>
              <option value="inativo">Inativo</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label>Descri√ß√£o</label>
          <textarea id="descricaoEbook" placeholder="Descri√ß√£o do ebook..."></textarea>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn-secondary" onclick="fecharModal('ebooks')">Cancelar</button>
          <button type="submit" class="btn-save">Salvar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- MODAL LIVROS -->
  <div id="modalLivros" class="modal-backdrop">
    <div class="modal">
      <div class="modal-header">
        <h2 id="modalTitleLivros" class="modal-title">Adicionar Livro</h2>
        <button class="btn-close" onclick="fecharModal('livros')">√ó</button>
      </div>
      <form id="formLivros" onsubmit="salvarProduto(event, 'livros')">
        <input type="hidden" id="editIdLivros" />
        <div class="form-group">
          <label>T√≠tulo *</label>
          <input type="text" id="tituloLivro" required />
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Autor *</label>
            <input type="text" id="autorLivro" required />
          </div>
          <div class="form-group">
            <label>ISBN</label>
            <input type="text" id="isbnLivro" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Pre√ßo (R$) *</label>
            <input type="number" id="precoLivro" step="0.01" min="0" required />
          </div>
          <div class="form-group">
            <label>Estoque</label>
            <input type="number" id="estoqueLivro" min="0" />
          </div>
        </div>
        <div class="form-group">
          <label>URL da Capa</label>
          <input type="url" id="capaLivro" placeholder="https://..." />
        </div>
        <div class="form-group">
          <label>Descri√ß√£o</label>
          <textarea id="descricaoLivro" placeholder="Descri√ß√£o do livro..."></textarea>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn-secondary" onclick="fecharModal('livros')">Cancelar</button>
          <button type="submit" class="btn-save">Salvar</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // ============================================
    // VERIFICA√á√ÉO ADMIN ‚Äî mant√©m governo ativo
    // ============================================
    function garantirAdmin() {
      const isAdmin = localStorage.getItem("admin") === "true";
      if (!isAdmin) {
        window.location.href = "auth_system.html";
        return false;
      }
      return true;
    }

    // ============================================
    // ESTADO
    // ============================================
    let produtos = {
      cursos: JSON.parse(localStorage.getItem("produtos_cursos") || "[]"),
      ebooks: JSON.parse(localStorage.getItem("produtos_ebooks") || "[]"),
      livros: JSON.parse(localStorage.getItem("produtos_livros") || "[]"),
    };

    // Para edi√ß√£o
    let editIndex = {
      cursos: null,
      ebooks: null,
      livros: null,
    };

    document.addEventListener("DOMContentLoaded", () => {
      if (!garantirAdmin()) return;

      renderizarTudo();
      atualizarStats();
    });

    // ============================================
    // TABS
    // ============================================
    function switchTab(tipo, el) {
      document.querySelectorAll(".tab").forEach((btn) => btn.classList.remove("active"));
      document.querySelectorAll(".panel").forEach((p) => (p.style.display = "none"));

      el.classList.add("active");
      document.getElementById("tab-" + tipo).style.display = "block";
    }

    // ============================================
    // RENDERIZA√á√ÉO
    // ============================================
    function renderizarTudo() {
      renderizarCursos();
      renderizarEbooks();
      renderizarLivros();
    }

    function renderizarCursos() {
      const tbody = document.getElementById("tableCursos");
      if (!produtos.cursos.length) {
        tbody.innerHTML = `
          <tr>
            <td colspan="6">
              <div class="empty-state">
                <div class="empty-state-icon">üì≠</div>
                <p>Nenhum curso cadastrado ainda.</p>
              </div>
            </td>
          </tr>`;
        return;
      }

      tbody.innerHTML = produtos.cursos
        .map(
          (c, i) => `
        <tr>
          <td><strong>${c.nome}</strong></td>
          <td>${c.tipo || "-"}</td>
          <td>${c.duracao || "-"}</td>
          <td>R$ ${Number(c.preco || 0).toFixed(2)}</td>
          <td>
            <span class="badge ${
              c.status === "ativo"
                ? "badge-success"
                : c.status === "inativo"
                ? "badge-danger"
                : "badge-warning"
            }">${c.status || "-"}</span>
          </td>
          <td class="actions">
            <button class="btn-icon" onclick="editarProduto('cursos', ${i})" title="Editar">‚úèÔ∏è</button>
            <button class="btn-icon danger" onclick="excluirProduto('cursos', ${i})" title="Excluir">üóëÔ∏è</button>
          </td>
        </tr>`
        )
        .join("");
    }

    function renderizarEbooks() {
      const tbody = document.getElementById("tableEbooks");
      if (!produtos.ebooks.length) {
        tbody.innerHTML = `
          <tr>
            <td colspan="6">
              <div class="empty-state">
                <div class="empty-state-icon">üì≠</div>
                <p>Nenhum ebook cadastrado ainda.</p>
              </div>
            </td>
          </tr>`;
        return;
      }

      tbody.innerHTML = produtos.ebooks
        .map(
          (e, i) => `
        <tr>
          <td><strong>${e.titulo}</strong></td>
          <td>${e.autor || "-"}</td>
          <td>R$ ${Number(e.preco || 0).toFixed(2)}</td>
          <td>${e.downloads || 0}</td>
          <td>
            <span class="badge ${
              e.status === "ativo" ? "badge-success" : "badge-danger"
            }">${e.status || "-"}</span>
          </td>
          <td class="actions">
            <button class="btn-icon" onclick="editarProduto('ebooks', ${i})" title="Editar">‚úèÔ∏è</button>
            <button class="btn-icon danger" onclick="excluirProduto('ebooks', ${i})" title="Excluir">üóëÔ∏è</button>
          </td>
        </tr>`
        )
        .join("");
    }

    function renderizarLivros() {
      const tbody = document.getElementById("tableLivros");
      if (!produtos.livros.length) {
        tbody.innerHTML = `
          <tr>
            <td colspan="6">
              <div class="empty-state">
                <div class="empty-state-icon">üì≠</div>
                <p>Nenhum livro cadastrado ainda.</p>
              </div>
            </td>
          </tr>`;
        return;
      }

      tbody.innerHTML = produtos.livros
        .map(
          (l, i) => `
        <tr>
          <td><strong>${l.titulo}</strong></td>
          <td>${l.autor || "-"}</td>
          <td>${l.isbn || "-"}</td>
          <td>R$ ${Number(l.preco || 0).toFixed(2)}</td>
          <td>
            <span class="badge ${
              (l.estoque || 0) > 0 ? "badge-success" : "badge-danger"
            }">${l.estoque || 0}</span>
          </td>
          <td class="actions">
            <button class="btn-icon" onclick="editarProduto('livros', ${i})" title="Editar">‚úèÔ∏è</button>
            <button class="btn-icon danger" onclick="excluirProduto('livros', ${i})" title="Excluir">üóëÔ∏è</button>
          </td>
        </tr>`
        )
        .join("");
    }

    // ============================================
    // STATS
    // ============================================
    function atualizarStats() {
      document.getElementById("statCursos").textContent = produtos.cursos.length;
      document.getElementById("statEbooks").textContent = produtos.ebooks.length;
      document.getElementById("statLivros").textContent = produtos.livros.length;
    }

    // ============================================
    // MODAL
    // ============================================
    function abrirModal(tipo, index = null) {
      if (!garantirAdmin()) return;

      editIndex[tipo] = index;

      if (tipo === "cursos") {
        const modal = document.getElementById("modalCursos");
        const title = document.getElementById("modalTitleCursos");
        const idInput = document.getElementById("editIdCursos");
        title.textContent = index === null ? "Adicionar Curso" : "Editar Curso";
        idInput.value = index !== null ? index : "";
        if (index !== null) {
          const c = produtos.cursos[index];
          document.getElementById("nomeCurso").value = c.nome || "";
          document.getElementById("tipoCurso").value = c.tipo || "";
          document.getElementById("duracaoCurso").value = c.duracao || "";
          document.getElementById("precoCurso").value = c.preco || "";
          document.getElementById("statusCurso").value = c.status || "ativo";
          document.getElementById("descricaoCurso").value = c.descricao || "";
        } else {
          document.getElementById("formCursos").reset();
          document.getElementById("statusCurso").value = "ativo";
        }
        modal.classList.add("active");
      }

      if (tipo === "ebooks") {
        const modal = document.getElementById("modalEbooks");
        const title = document.getElementById("modalTitleEbooks");
        const idInput = document.getElementById("editIdEbooks");
        title.textContent = index === null ? "Adicionar Ebook" : "Editar Ebook";
        idInput.value = index !== null ? index : "";
        if (index !== null) {
          const e = produtos.ebooks[index];
          document.getElementById("tituloEbook").value = e.titulo || "";
          document.getElementById("autorEbook").value = e.autor || "";
          document.getElementById("precoEbook").value = e.preco || "";
          document.getElementById("linkEbook").value = e.link || "";
          document.getElementById("capaEbook").value = e.capa || "";
          document.getElementById("statusEbook").value = e.status || "ativo";
          document.getElementById("descricaoEbook").value = e.descricao || "";
        } else {
          document.getElementById("formEbooks").reset();
          document.getElementById("statusEbook").value = "ativo";
        }
        modal.classList.add("active");
      }

      if (tipo === "livros") {
        const modal = document.getElementById("modalLivros");
        const title = document.getElementById("modalTitleLivros");
        const idInput = document.getElementById("editIdLivros");
        title.textContent = index === null ? "Adicionar Livro" : "Editar Livro";
        idInput.value = index !== null ? index : "";
        if (index !== null) {
          const l = produtos.livros[index];
          document.getElementById("tituloLivro").value = l.titulo || "";
          document.getElementById("autorLivro").value = l.autor || "";
          document.getElementById("isbnLivro").value = l.isbn || "";
          document.getElementById("precoLivro").value = l.preco || "";
          document.getElementById("estoqueLivro").value = l.estoque || 0;
          document.getElementById("capaLivro").value = l.capa || "";
          document.getElementById("descricaoLivro").value = l.descricao || "";
        } else {
          document.getElementById("formLivros").reset();
        }
        modal.classList.add("active");
      }
    }

    function fecharModal(tipo) {
      if (tipo === "cursos") {
        document.getElementById("modalCursos").classList.remove("active");
      }
      if (tipo === "ebooks") {
        document.getElementById("modalEbooks").classList.remove("active");
      }
      if (tipo === "livros") {
        document.getElementById("modalLivros").classList.remove("active");
      }
      editIndex[tipo] = null;
    }

    // ============================================
    // SALVAR PRODUTO
    // ============================================
    function salvarProduto(event, tipo) {
      event.preventDefault();
      if (!garantirAdmin()) return;

      let produto = {};
      if (tipo === "cursos") {
        produto = {
          nome: document.getElementById("nomeCurso").value,
          tipo: document.getElementById("tipoCurso").value,
          duracao: document.getElementById("duracaoCurso").value,
          preco: parseFloat(document.getElementById("precoCurso").value || "0"),
          status: document.getElementById("statusCurso").value,
          descricao: document.getElementById("descricaoCurso").value,
          dataCriacao: new Date().toISOString(),
        };
      } else if (tipo === "ebooks") {
        produto = {
          titulo: document.getElementById("tituloEbook").value,
          autor: document.getElementById("autorEbook").value,
          preco: parseFloat(document.getElementById("precoEbook").value || "0"),
          link: document.getElementById("linkEbook").value,
          capa: document.getElementById("capaEbook").value,
          status: document.getElementById("statusEbook").value,
          descricao: document.getElementById("descricaoEbook").value,
          downloads: produtos.ebooks[editIndex.ebooks]?.downloads || 0,
          dataCriacao: new Date().toISOString(),
        };
      } else if (tipo === "livros") {
        produto = {
          titulo: document.getElementById("tituloLivro").value,
          autor: document.getElementById("autorLivro").value,
          isbn: document.getElementById("isbnLivro").value,
          preco: parseFloat(document.getElementById("precoLivro").value || "0"),
          estoque: parseInt(document.getElementById("estoqueLivro").value || "0", 10),
          capa: document.getElementById("capaLivro").value,
          descricao: document.getElementById("descricaoLivro").value,
          dataCriacao: new Date().toISOString(),
        };
      }

      if (editIndex[tipo] !== null && editIndex[tipo] !== undefined) {
        produtos[tipo][editIndex[tipo]] = produto;
      } else {
        produtos[tipo].push(produto);
      }

      localStorage.setItem("produtos_" + tipo, JSON.stringify(produtos[tipo]));
      fecharModal(tipo);
      renderizarTudo();
      atualizarStats();
    }

    // ============================================
    // EDITAR / EXCLUIR
    // ============================================
    function editarProduto(tipo, index) {
      abrirModal(tipo, index);
    }

    function excluirProduto(tipo, index) {
      if (!garantirAdmin()) return;
      if (!confirm("Deseja realmente excluir este registro?")) return;

      produtos[tipo].splice(index, 1);
      localStorage.setItem("produtos_" + tipo, JSON.stringify(produtos[tipo]));
      renderizarTudo();
      atualizarStats();
    }

    // ============================================
    // FILTRO (b√°sico - console)
    // ============================================
    function filtrar(tipo, termo) {
      console.log("Filtro digitado para", tipo, ":", termo);
      // Pode evoluir depois para filtro real na tabela
    }
  </script>
</body>
</html>
